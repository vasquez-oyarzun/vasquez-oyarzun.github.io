<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html lang="en"> 
    <head> 
        <meta charset="UTF-8" />
        <title>Phaser - Making your first game, part 9</title>
        <script type="text/javascript" src="js/phaser.2.6.2.min.js"></script>
        <style type="text/css">
            body {
                margin: 0;
            }
        </style>
    </head>
    <body>

        <script type="text/javascript">

            var game = new Phaser.Game(800, 600, Phaser.AUTO, '', {preload: preload, create: create, update: update});
            function preload() {
                game.load.image('pinches', 'hielo/pinches de hielo.png');
                game.load.image('boton', 'hielo/boton.png');
                game.load.image('fondo', 'hielo/fondo.jpg');
                game.load.image('plataforma', 'hielo/plataformas.png');
                game.load.spritesheet('alien', 'hielo/alien.png', 151, 150);
                game.load.spritesheet('hombre', 'hielo/hombre corriendo.png', 128.8, 160);
                game.load.image('artefacto', 'hielo/artefacto.png');
                game.load.image('pinche', 'hielo/pinche.png');
            }
            var bloque, artefaco, izq = false;
            var booleano = true;
            var enemigo, enemigo1;
            var platforms;
            var cursors;
            var vidas = 5;
            var vidasText;
            var fondo, fin;
            var player;
            var pinches;
            var atacando = false;
            var atacando1 = false;
            var atacando2 = false;
            var pieza;
            var msj;
            var finJuego = false;
            var pinche1, pinche2, pinche3, pinche4, pinche5, pinche6;
            var listo1 = true, listo2 = true, listo3 = true, listo4 = true, listo5 = true, listo6 = true;
            function controlPinches() {

                if (distancex(player, pinche1) && listo1) {
                    pinche1.body.velocity.y = 400;
                }
                if (distancex(player, pinche2) && listo2) {
                    pinche2.body.velocity.y = 400;
                }
                if (distancex(player, pinche3) && listo3) {
                    pinche3.body.velocity.y = 400;
                }
                if (distancex(player, pinche4) && listo4) {
                    pinche4.body.velocity.y = 400;
                }
                if (distancex(player, pinche5) && listo5) {
                    pinche5.body.velocity.y = 400;
                }
                if (distancex(player, pinche6) && listo6) {
                    pinche6.body.velocity.y = 400;
                }
                if (pinche1.y > (game.world.height - 100)) {
                    pinche1.kill();
                    recrearPinches(1);
                    listo1 = false;

                }
                if (pinche2.y > (game.world.height - 100)) {
                    pinche2.kill();
                    recrearPinches(2);
                    listo2 = false;
                }
                if (pinche3.y > (game.world.height - 100)) {
                    pinche3.kill();
                    recrearPinches(3);
                    listo3 = false;
                }
                if (pinche4.y > (game.world.height - 100)) {
                    pinche4.kill();
                    recrearPinches(4);
                    listo4 = false;
                }
                if (pinche5.y > (game.world.height - 100)) {
                    pinche5.kill();
                    recrearPinches(5);
                    listo5 = false;

                }
                if (pinche6.y > (game.world.height - 100)) {
                    pinche6.kill();
                    recrearPinches(6);
                    listo6 = false;

                }
                if (!(listo1)) {
                    if (pinche1.y < 0) {
                        pinche1.body.velocity.y = 20;
                    }
                    else {
                        pinche1.body.velocity.y = 0;
                        listo1 = true;
                    }

                }
                if (!(listo2)) {
                    if (pinche2.y < 0) {
                        pinche2.body.velocity.y = 20;
                    }
                    else {
                        pinche2.body.velocity.y = 0;
                        listo2 = true;
                    }
                }
                if (!(listo3)) {
                    if (pinche3.y < 0) {
                        pinche3.body.velocity.y = 20;
                    }
                    else {
                        pinche3.body.velocity.y = 0;
                        listo3 = true;
                    }
                }
                if (!(listo4)) {
                    if (pinche4.y < 0) {
                        pinche4.body.velocity.y = 20;
                    }
                    else {
                        pinche4.body.velocity.y = 0;
                        listo4 = true;
                    }
                }
                if (!(listo5)) {
                    if (pinche5.y < 0) {
                        pinche5.body.velocity.y = 20;
                    }
                    else {
                        pinche5.body.velocity.y = 0;
                        listo5 = true;
                    }

                }
                if (!(listo6)) {
                    if (pinche6.y < 0) {
                        pinche6.body.velocity.y = 20;
                    }
                    else {
                        pinche6.body.velocity.y = 0;
                        listo6 = true;
                    }

                }

            }
            function recrearPinches(num) {
                if (num === 1) {
                    pinche1 = game.add.sprite(200 * num, -100, 'pinche');
                    pinche1.scale.setTo(0.5, 0.5);
                    game.physics.arcade.enable(pinche1);
                    pinche1.enableBody = true;
                }
                if (num === 2) {
                    pinche2 = game.add.sprite(200 * num, -100, 'pinche');
                    pinche2.scale.setTo(0.5, 0.5);
                    game.physics.arcade.enable(pinche2);
                    pinche2.enableBody = true;
                }
                if (num === 3) {
                    pinche3 = game.add.sprite(200 * num, -100, 'pinche');
                    pinche3.scale.setTo(0.5, 0.5);
                    game.physics.arcade.enable(pinche3);
                    pinche3.enableBody = true;
                }
                if (num === 4) {
                    pinche4 = game.add.sprite(200 * num, -100, 'pinche');
                    pinche4.scale.setTo(0.5, 0.5);
                    game.physics.arcade.enable(pinche4);
                    pinche4.enableBody = true;
                }
                if (num === 5) {
                    pinche5 = game.add.sprite(200 * num, -100, 'pinche');
                    pinche5.scale.setTo(0.5, 0.5);
                    game.physics.arcade.enable(pinche5);
                    pinche5.enableBody = true;
                }
                if (num === 6) {
                    pinche6 = game.add.sprite(200 * num, -100, 'pinche');
                    pinche6.scale.setTo(0.5, 0.5);
                    game.physics.arcade.enable(pinche6);
                    pinche6.enableBody = true;
                }
            }
            function iniciarPinchecitos() {
                pinche1 = game.add.sprite(200, 0, 'pinche');
                pinche1.scale.setTo(0.5, 0.5);
                game.physics.arcade.enable(pinche1);
                pinche1.enableBody = true;
                pinche2 = game.add.sprite(400, 0, 'pinche');
                pinche2.scale.setTo(0.5, 0.5);
                pinche2.enableBody = true;
                game.physics.arcade.enable(pinche2);
                pinche3 = game.add.sprite(600, 0, 'pinche');
                pinche3.scale.setTo(0.5, 0.5);
                pinche3.enableBody = true;
                game.physics.arcade.enable(pinche3);
                pinche4 = game.add.sprite(800, 0, 'pinche');
                pinche4.scale.setTo(0.5, 0.5);
                pinche4.enableBody = true;
                game.physics.arcade.enable(pinche4);
                pinche5 = game.add.sprite(1000, 0, 'pinche');
                pinche5.scale.setTo(0.5, 0.5);
                pinche5.enableBody = true;
                game.physics.arcade.enable(pinche5);
                pinche6 = game.add.sprite(1200, 0, 'pinche');
                pinche6.scale.setTo(0.5, 0.5);
                pinche6.enableBody = true;
                game.physics.arcade.enable(pinche6);

            }
            function iniciarPlataformas() {
                platforms = game.add.group();
                platforms.enableBody = true;
                var ground = platforms.create(0, game.world.height - 64, 'plataforma');
                ground.scale.setTo(0.40, 1);
                ground.body.immovable = true;
                var ledge = platforms.create(550, 300, 'plataforma');
                ledge.scale.setTo(0.10, 0.4);
                ledge.body.immovable = true;
                ground = platforms.create(800, game.world.height - 64, 'plataforma');
                ground.body.immovable = true;
                ledge = platforms.create(850, 320, 'plataforma');
                ledge.scale.setTo(0.15, 0.40);
                ledge.body.immovable = true;
                ledge = platforms.create(190, 350, 'plataforma');
                ledge.scale.setTo(0.15, 0.40);
                ledge.body.immovable = true;
                ledge = platforms.create(1200, 355, 'plataforma');
                ledge.scale.setTo(0.10, 0.40);
                ledge.body.immovable = true;
            }
            function iniciarJugador() {
                player = game.add.sprite(0, 450, 'hombre'); //32 igual anterior
                player.scale.setTo(0.5, 0.5);
                game.physics.arcade.enable(player);
                player.body.gravity.y = 300;
                player.body.collideWorldBounds = true;
                player.animations.add('derecha', [1, 2, 3, 4, 5, 6, 7, 8], 12, true);
                player.animations.add('izquierda', [16, 15, 14, 13, 12, 11, 10, 9], 12, true);

            }
            function iniciarEnemigos() {
                enemigo = game.add.sprite(250, game.world.height - 220, 'alien');
                enemigo1 = game.add.sprite(900, game.world.height - 220, 'alien');
                enemigo2 = game.add.sprite(1200, game.world.height - 220, 'alien');
                game.physics.arcade.enable(enemigo);
                game.physics.arcade.enable(enemigo1);
                game.physics.arcade.enable(enemigo2);
                enemigo.body.gravity.y = 300;
                enemigo.body.collideWorldBounds = true;
                enemigo1.body.gravity.y = 300;
                enemigo1.body.collideWorldBounds = true;
                enemigo2.body.gravity.y = 300;
                enemigo2.body.collideWorldBounds = true;

                enemigo.animations.add('atacarder', [18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31], 20, true);
                enemigo.animations.add('atacarizq', [48, 47, 46, 45, 44, 43, 42, 41, 40, 39, 38, 37, 36, 35], 20, true);
                enemigo.animations.add('atacar', [18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31], 20, true);
                enemigo.animations.add('left', [66, 65, 64, 63, 62, 61, 60, 59, 58, 57, 56, 55, 54, 53, 52, 51, 50, 49], 20, true);
                enemigo.animations.add('right', [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17], 20, true);

                enemigo1.animations.add('atacarder', [18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31], 20, true);
                enemigo1.animations.add('atacarizq', [48, 47, 46, 45, 44, 43, 42, 41, 40, 39, 38, 37, 36, 35], 20, true);
                enemigo1.animations.add('atacar', [18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31], 20, true);
                enemigo1.animations.add('left', [66, 65, 64, 63, 62, 61, 60, 59, 58, 57, 56, 55, 54, 53, 52, 51, 50, 49], 20, true);
                enemigo1.animations.add('right', [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17], 20, true);

                enemigo2.animations.add('atacarder', [18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31], 20, true);
                enemigo2.animations.add('atacarizq', [48, 47, 46, 45, 44, 43, 42, 41, 40, 39, 38, 37, 36, 35], 20, true);
                enemigo2.animations.add('atacar', [18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31], 20, true);
                enemigo2.animations.add('left', [66, 65, 64, 63, 62, 61, 60, 59, 58, 57, 56, 55, 54, 53, 52, 51, 50, 49], 20, true);
                enemigo2.animations.add('right', [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17], 20, true);

            }

            function iniciarPinches() {
                pinches = game.add.group();
                pinches.enableBody = true;
                var pinche = pinches.create(510, game.world.height - 132, 'pinches');
                pinche.scale.setTo(0.85, 0.8);
                pinche.body.immovable = true;
                pinche = pinches.create(250, 310, 'pinches');
                pinche.scale.setTo(0.20, 0.25);
                pinche.body.immovable = true;
                pinche = pinches.create(910, 280, 'pinches');
                pinche.scale.setTo(0.20, 0.25);
                pinche.body.immovable = true;
                pinche = pinches.create(605, 260, 'pinches');
                pinche.scale.setTo(0.18, 0.25);
                pinche.body.immovable = true;
            }

            function create() {
                game.world.setBounds(0, 0, 1400, 600);
                game.physics.startSystem(Phaser.Physics.ARCADE);
                fondo = game.add.sprite(0, 0, 'fondo');
                artefacto = game.add.sprite(1100, 450, 'artefacto');
                artefacto.scale.setTo(0.1, 0.1);
                artefacto.enableBody = true;
                game.physics.arcade.enable(artefacto);
                artefacto.enableBody = true;
                reiniciar = game.add.group();
                reiniciar.enableBody = true;
                iniciarPlataformas();
                iniciarJugador();
                iniciarEnemigos();
                iniciarPinches();
                iniciarPinchecitos();
                vidasText = game.add.text(16, 16, 'Vidas: 5', {fontSize: '32px', fill: '#000'});
                cursors = game.input.keyboard.createCursorKeys();
                fin = false;
                fin1 = false;
                fin2 = true;

            }

            function update() {
                game.camera.follow(player);
                vidasText.x = game.camera.x + 16;
                fondo.x = game.camera.x;
                game.physics.arcade.collide(enemigo2, platforms);
                game.physics.arcade.collide(enemigo1, platforms);
                game.physics.arcade.collide(enemigo, platforms);
                game.physics.arcade.collide(enemigo2, pinches);
                game.physics.arcade.collide(enemigo1, pinches);
                game.physics.arcade.collide(enemigo, pinches);
                game.physics.arcade.collide(player, platforms);
                game.physics.arcade.overlap(player, pinches, dieP, null, this);
                game.physics.arcade.overlap(player, enemigo, dieE, null, this);
                game.physics.arcade.overlap(player, enemigo1, dieE, null, this);
                game.physics.arcade.overlap(player, enemigo2, dieE, null, this);
                game.physics.arcade.overlap(player, artefacto, ganar, null, this);
                if (!finJuego) {
                    if (distance(enemigo.body.center, player.body.center) <= 40) {
                        if (enemigo.body.center.x <= player.body.center.x) {
                            enemigo.animations.play("atacarder");

                        } else {

                            enemigo.animations.play("atacarizq");
                        }
                        enemigo.body.velocity.x = 0;
                        atacando = true;
                    } else {
                        if (fin === false) {
                            enemigo.body.velocity.x = 300;
                            enemigo.animations.play('right');
                            atacando = false;
                            fin = enemigo.x === 359;
                        } else {
                            enemigo.body.velocity.x = -300;
                            enemigo.animations.play('left');
                            atacando = false;
                            fin = !(enemigo.x === 0);
                        }
                    }
                    if (distance(enemigo1.body.center, player.body.center) <= 40) {
                        if (enemigo1.body.center.x <= player.body.center.x) {
                            enemigo1.animations.play("atacarder");

                        } else {
                            enemigo1.animations.play("atacarizq");
                        }
                        enemigo1.body.velocity.x = 0;
                        atacando1 = true;
                    } else {
                        if (fin1 === false) {
                            enemigo1.body.velocity.x = 300;
                            enemigo1.animations.play('right');
                            atacando1 = false;
                            fin1 = enemigo1.x >= 1249;
                        } else {
                            enemigo1.body.velocity.x = -300;
                            enemigo1.animations.play('left');
                            atacando1 = false;
                            fin1 = !(enemigo1.x <= 810.8);
                        }
                    }
                    if (distance(enemigo2.body.center, player.body.center) <= 40) {
                        if (enemigo2.body.center.x <= player.body.center.x) {
                            enemigo2.animations.play("atacarder");

                        } else {
                            enemigo2.animations.play("atacarizq");
                        }
                        enemigo2.body.velocity.x = 0;
                        atacando2 = true;
                    } else {
                        if (fin2 === false) {
                            enemigo2.body.velocity.x = 400;
                            enemigo2.animations.play('right');
                            atacando2 = false;
                            fin2 = enemigo2.x >= 1249;
                        } else {
                            enemigo2.body.velocity.x = -400;
                            enemigo2.animations.play('left');
                            atacando2 = false;
                            fin2 = !(enemigo2.x <= 810.8);
                        }
                    }
                    if (vidas <= 0) {
                        enemigo.animations.stop();
                        enemigo1.animations.stop();
                        enemigo2.animations.stop();
                        enemigo.body.velocity.x = 0;
                        enemigo1.body.velocity.x = 0;
                        enemigo2.body.velocity.x = 0;
                        finJuego=true;


                    }
                    if (cursors.up.isDown) {
                        if (player.body.touching.down) {
                            player.body.velocity.y = -350;
                        } else {
                            if (cursors.right.isDown) {
                                player.body.velocity.x = 150;
                                player.frame = 6;
                            }
                            else {
                                if (cursors.left.isDown) {
                                    player.body.velocity.x = -150;
                                    player.frame = 11;
                                }
                            }
                        }

                    }
                    if (cursors.right.isDown) {
                        izq = false;
                        player.body.velocity.x = 150;
                        player.animations.play('derecha');
                    }
                    else {
                        if (cursors.left.isDown) {
                            izq = true;
                            player.body.velocity.x = -150;
                            player.animations.play('izquierda');
                        }
                        else {
                            player.animations.stop();
                            player.body.velocity.x = 0;
                            if (izq) {
                                player.frame = 17;
                            }
                            else {
                                player.frame = 0;
                            }
                        }
                    }


                    if (distance(player, pinche1.body.center) < 50) {
                        dieP();
                    }
                    if (distance(player, pinche2.body.center) < 50) {
                        dieP();
                    }
                    if (distance(player, pinche3.body.center) < 50) {
                        dieP();
                    }
                    if (distance(player, pinche4.body.center) < 50) {
                        dieP();
                    }
                    if (distance(player, pinche5.body.center) < 50) {
                        dieP();
                    }
                    if (distance(player, pinche6.body.center) < 50) {
                        dieP();
                    }
                    controlPinches();
                    if (booleano === true) {
                        artefacto.body.velocity.y = -40;
                        if (artefacto.y < 430) {
                            booleano = false;
                        }
                    }
                    else {
                        artefacto.body.velocity.y = 40;
                        if (artefacto.y > 480) {
                            booleano = true;
                        }
                    }
                }
            }

            function dieP() {
                player.kill();
                if (vidas - 1 >= 0) {
                    vidas -= 1;
                }
                vidasText.text = 'Vidas: ' + vidas;
                if (vidas > 0) {
                    iniciarJugador();
                    game.camera.follow(player);
                }
                else {
                    msj = game.add.text(game.camera.x, 300, 'REINICIAR?', {fontSize: '100px', fill: '#000'});
                    boton = reiniciar.create(game.camera.x + 600, 300, 'boton');
                    boton.scale.setTo(0.25, 0.25);
                    boton.inputEnabled = true;
                    boton.events.onInputDown.add(reinicio, this);
                }
            }
            function reinicio() {
                vidas = 5;
                finJuego=false;
                game.state.start(game.state.current);
            }
            function dieE(player, enemigo) {
                if ((atacando || atacando1 || atacando2) && (enemigo.frame === 27 || enemigo.frame === 39)) {
                    player.kill();
                    vidas -= 1;
                    vidasText.text = 'Vidas: ' + vidas;
                    if (vidas > 0) {
                        iniciarJugador();
                        game.camera.follow(player);
                    } else {
                        msj = game.add.text(game.camera.x, 300, 'REINICIAR?', {fontSize: '100px', fill: '#000'});
                        boton = reiniciar.create(game.camera.x + 600, 300, 'boton');
                        boton.scale.setTo(0.25, 0.25);
                        boton.inputEnabled = true;
                        boton.events.onInputDown.add(reinicio, this);
                    }
                }
            }

            function ganar(player, pi) {
                pi.kill();
                msj = game.add.text(game.camera.x, 100, 'BIEN!\nPARA SIGUIENTE NIVEL..\nPRESIONA EL BOTON', {fontSize: '50px', fill: '#000'});
                atacando = false;
                atacando1 = false;
                atacando2 = false;
                enemigo.animations.stop();
                enemigo1.animations.stop();
                enemigo2.animations.stop();
                pinche1.body.velocity.y = 0;
                pinche2.body.velocity.y = 0;
                pinche3.body.velocity.y = 0;
                pinche4.body.velocity.y = 0;
                pinche5.body.velocity.y = 0;
                pinche6.body.velocity.y = 0;
                player.animations.stop()
                enemigo.body.velocity.x = 0;
                enemigo1.body.velocity.x = 0;
                enemigo2.body.velocity.x = 0;
                player.body.velocity.x = 0;
                finJuego = true;
                boton = reiniciar.create(game.camera.x + 100, 300, 'boton');
                boton.scale.setTo(0.25, 0.25);
                boton.inputEnabled = true;
                boton.events.onInputDown.add(sigNivel, this);
            }
            function sigNivel() {
                location.href = "agua.html";

            }
            function distance(a, b) {
                return Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y));
            }
            function distancex(a, b) {
                var retorno = false;
                var calculo;
                calculo = Math.abs((a.body.center.x) - (b.body.center.x));
                if (calculo < 50) {
                    retorno = true;
                }
                return retorno;
            }


        </script>

    </body>
</html>