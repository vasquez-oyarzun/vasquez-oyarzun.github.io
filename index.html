<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html lang="en"> 
    <head> 
        <meta charset="UTF-8" />
        <title>Phaser - Making your first game, part 9</title>
        <script type="text/javascript" src="js/phaser.2.6.2.min.js"></script>
        <style type="text/css">
            body {
                margin: 0;
            }
        </style>
    </head>
    <body>

        <script type="text/javascript">

            var game = new Phaser.Game(800, 600, Phaser.AUTO, '', {preload: preload, create: create, update: update});
            function preload() {

                game.load.image('pinches', 'assets/pinches de hielo.png ');
                game.load.image('sky', 'assets/fondo.jpg ');
                game.load.image('ground', 'assets/plataformas.png');
                game.load.image('star', 'assets/star.png');
                game.load.spritesheet('dude', 'assets/corre y ataca corregido.png', 151, 150);
                game.load.spritesheet('dudo', 'assets/hombre corriendo.png', 128.8, 160);
                //ame.load.spritesheet('dudo', 'assets/alien.png', 104, 150);
            }

            var enemigo;
            var platforms;
            var cursors;
            var stars;
            var score = 0;
            var vidas = 2;
            var vidasText;
            var scoreText;
            var fondo;
            var player;
            var pinches, t_s, t_d, t_w;
            var atacando = false;
            function create() {
                game.world.setBounds(0, 0, 4000, 600);
                //  We're going to be using physics, so enable the Arcade Physics system
                game.physics.startSystem(Phaser.Physics.ARCADE);

                //  A simple background for our game
                fondo = game.add.sprite(0, 0, 'sky');
                //  The platforms group contains the ground and the 2 ledges we can jump on
                platforms = game.add.group();
                //  We will enable physics for any object that is created in this group
                platforms.enableBody = true;
                // Here we create the ground.
                var ground = platforms.create(0, game.world.height - 64, 'ground');
                //  Scale it to fit the width of the game (the original sprite is 400x32 in size)
                //  This stops it from falling away when you jump on it
                ground.body.immovable = true;
                //  Now let's create two ledges
                var ledge = platforms.create(400, 350, 'ground');
                ledge.scale.setTo(0.15, 0.40);
                ledge.body.immovable = true;
                ledge = platforms.create(-400, 180, 'ground');
                ledge.scale.setTo(0.5, 0.40);
                ledge.body.immovable = true;
                // The player and its settings
                enemigo = game.add.sprite(32, game.world.height - 220, 'dude');
                player = game.add.sprite(32, game.world.height - 220, 'dudo');
                player.scale.setTo(0.5, 0.5);
                //  We need to enable physics on the player
                game.physics.arcade.enable(enemigo);
                game.physics.arcade.enable(player);
                //  Player physics properties. Give the little guy a slight bounce.
                enemigo.body.bounce.y = 0.2;
                enemigo.body.gravity.y = 300;
                enemigo.body.collideWorldBounds = true;
                //player.body.bounce.y = 0.2;
                player.body.gravity.y = 500;
                player.body.collideWorldBounds = true;
                enemigo.animations.add('atacar', [18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31], 20, true);
                //  Our two animations, walking left and right.
                enemigo.animations.add('left', [0, 1, 2, 3], 10, true);
                enemigo.animations.add('right', [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17], 20, true);
                player.animations.add('derecha', [1, 2, 3, 4, 5, 6, 7, 8], 12, true);
                player.animations.add('izquierda', [16, 15, 14, 13, 12, 11, 10, 9], 12, true);
                //  Finally some stars to collect
                stars = game.add.group();
                //  We will enable physics for any star that is created in this group
                stars.enableBody = true;
                pinches = game.add.group();
                pinches.enableBody = true;
                //  Here we'll create 12 of them evenly spaced apart
                for (var i = 0; i < 12; i++)
                {
                    //  Create a star inside of the 'stars' group
                    var star = stars.create(i * 70, 0, 'star');
                    //  Let gravity do its thing
                    star.body.gravity.y = 300;
                    //  This just gives each star a slightly random bounce value
                    star.body.bounce.y = 0.7 + Math.random() * 0.2;
                }
                for (var j = 0; j < 2; j++) {
                    var pinche = pinches.create((j + 1) * 300 + (100 * j), game.world.height - 105, 'pinches');
                    pinche.scale.setTo(0.25, 0.25);
                    pinche.body.immovable = true;

                }

                //  The score
                scoreText = game.add.text(16, 16, 'Score: 0', {fontSize: '32px', fill: '#000'});
                vidasText = game.add.text(180, 16, 'Vidas: 2', {fontSize: '32px', fill: '#000'});

                //  Our controls.
                cursors = game.input.keyboard.createCursorKeys();
                t_s = game.input.keyboard.addKey(Phaser.KeyCode.S);
                t_d = game.input.keyboard.addKey(Phaser.KeyCode.D);
                t_w = game.input.keyboard.addKey(Phaser.KeyCode.W);

            }

            function update() {

                game.camera.follow(player);
                scoreText.x = game.camera.x + 16;
                vidasText.x = game.camera.x + 180;
                fondo.x = game.camera.x;
                //  Collide the player and the stars with the platforms
                game.physics.arcade.collide(enemigo, platforms);
                game.physics.arcade.collide(stars, platforms);
                game.physics.arcade.collide(player, platforms);

                //  Checks to see if the player overlaps with any of the stars, if he does call the collectStar function
                game.physics.arcade.overlap(player, stars, collectStar, null, this);
                game.physics.arcade.overlap(player, pinches, dieP, null, this);
                game.physics.arcade.overlap(player, enemigo, dieE, null, this);

                //  Reset the players velocity (movement)
                enemigo.body.velocity.x = 0;
                if (t_d.isDown) {
                    enemigo.body.velocity.x = +150;
                    enemigo.animations.play('right');
                    atacando = false;
                }
                else {
                    if (t_w.isDown) {
                        enemigo.animations.play('atacar');
                        atacando = true;
                    }

                    else {
                        enemigo.animations.stop();
                        atacando = false;
                    }
                }
                if (cursors.up.isDown) {
                    if (player.body.touching.down) {
                        player.body.velocity.y = -350;
                    }else{
                    if (cursors.right.isDown) {
                        player.body.velocity.x = 150;
                        player.frame = 6;
                    }
                    else {
                        if (cursors.left.isDown) {
                            player.body.velocity.x = -150;
                            player.frame = 11;
                        }
                    }
                    }

 }
                if (cursors.right.isDown) {
                    //  Move to the right
                    player.body.velocity.x = 150;
                    player.animations.play('derecha');

                    //player.animations.play('right');
                }
                else {
                    if (cursors.left.isDown) {
                        player.body.velocity.x = -150;
                        player.animations.play('izquierda');

                    }
                    else {
                        player.animations.stop();
                        player.body.velocity.x = 0;
                        player.frame = 0;
                    }
                }

                //  Allow the player to jump if they are touching the ground.

                /*if (player.y === game.world.height) {
                 dieP(player, pinches);
                 }*/


            }

            function collectStar(player, star) {

                // Removes the star from the screen
                star.kill();
                //  Add and update the score
                score += 10;
                scoreText.text = 'Score: ' + score;
            }
            function dieP(player1, pinches) {
                // Removes the star from the screen
                player1.kill();
                //  Add and update the score
                vidas -= 1;
                vidasText.text = 'Vidas: ' + vidas;
                if (vidas > 0) {
                    player = game.add.sprite(32, game.world.height - 220, 'dudo');
                    player.scale.setTo(0.5, 0.5);
                    game.physics.arcade.enable(player);
                    player.body.bounce.y = 0.2;
                    player.body.gravity.y = 300;
                    player.body.collideWorldBounds = true;
                    player.animations.add('derecha', [1, 2, 3, 4, 5, 6, 7, 8], 12, true);
                    player.animations.add('izquierda', [16, 15, 14, 13, 12, 11, 10, 9], 12, true);

                }
            }
            function dieE(player1, enemigo) {

                // Removes the star from the screen
                if (atacando && enemigo.frame === 27) {
                    player1.kill();
                    //  Add and update the score
                    vidas -= 1;
                    vidasText.text = 'Vidas: ' + vidas;
                    if (vidas > 0) {
                        player = game.add.sprite(32, game.world.height - 220, 'dudo');
                        player.scale.setTo(0.5, 0.5);
                        game.physics.arcade.enable(player);
                        player.body.bounce.y = 0.2;
                        player.body.gravity.y = 300;
                        player.body.collideWorldBounds = true;
                        player.animations.add('derecha', [1, 2, 3, 4, 5, 6, 7, 8], 12, true);
                        player.animations.add('izquierda', [16, 15, 14, 13, 12, 11, 10, 9], 12, true);

                    }
                }
            }

        </script>

    </body>
</html>